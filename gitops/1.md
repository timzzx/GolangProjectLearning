# ä»Žé›¶ä¸Šæ‰‹gitops(multipassä½¿ç”¨)

## multipass
å¯ä»¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ubuntuï¼Œè¿˜æœ‰è‡ªå¸¦docker ã€ minikubeç­‰çŽ¯å¢ƒçš„é•œåƒä½¿ç”¨è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä¸ªäººæ„Ÿè§‰èµ„æºæ¶ˆè€—æ¯”vboxå°
> æŸ¥çœ‹é•œåƒ 
```shell
âžœ  ~ multipass find
Image                       Aliases           Version          Description
18.04                       bionic            20230329         Ubuntu 18.04 LTS
20.04                       focal             20230209         Ubuntu 20.04 LTS
22.04                       jammy,lts         20230416         Ubuntu 22.04 LTS
anbox-cloud-appliance                         latest           Anbox Cloud Appliance
charm-dev                                     latest           A development and testing environment for charmers
docker                                        0.4              A Docker environment with Portainer and related tools
jellyfin                                      latest           Jellyfin is a Free Software Media System that puts you in control of managing and streaming your media.
minikube                                      latest           minikube is local Kubernetes
ros-noetic                                    0.1              A development and testing environment for ROS Noetic.
ros2-humble                                   0.1              A development and testing environment for ROS 2 Humble.
```

> å®‰è£…è™šæ‹Ÿæœº
```shell
multipass launch -n test docker

$ multipass launch -n test01 -c 2 -m 4G -d 10G
```

+ -n, â€“name: åç§°
+ -c, â€“cpus: cpuæ ¸å¿ƒæ•°, é»˜è®¤: 1
+ -m, â€“mem: å†…å­˜å¤§å°, é»˜è®¤: 1G
+ -d, â€“disk: ç¡¬ç›˜å¤§å°, é»˜è®¤: 5G

> åˆ é™¤
```shell
# å¯åŠ¨å®žä¾‹
$ multipass start test01
# åœæ­¢å®žä¾‹
$ multipass stop test01
# åˆ é™¤å®žä¾‹ï¼ˆåˆ é™¤åŽï¼Œè¿˜ä¼šå­˜åœ¨ï¼‰
$ multipass delete test01
# é‡Šæ”¾å®žä¾‹ï¼ˆå½»åº•åˆ é™¤ï¼‰
$ multipass purge test01
```
## å®‰è£…docker 
> ä¸Šé¢é€‰æ‹©äº†dockerç³»ç»Ÿé»˜è®¤å®‰è£…çš„ubuntuç‰ˆæœ¬ï¼Œæ‰€ä»¥ç•¥è¿‡

## å®‰è£…kubectl
```shell
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
```

## å®‰è£…kind
```shell
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.18.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind
```

## åˆ›å»ºk8s
> åˆ›å»ºconfig.yaml
```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
```
> åˆ›å»ºé›†ç¾¤
```shell
â¯ kind create cluster --config config.yaml
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.26.3) ðŸ–¼ 
 âœ“ Preparing nodes ðŸ“¦  
 âœ“ Writing configuration ðŸ“œ 
 âœ“ Starting control-plane ðŸ•¹ï¸ 
 âœ“ Installing CNI ðŸ”Œ 
 âœ“ Installing StorageClass ðŸ’¾ 
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ðŸ™‚
```

> éƒ¨ç½²å®¹å™¨é•œåƒåˆ°K8s
vim flask-pod.yaml
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: hello-world-flask
spec:
  containers:
    - name: flask
      image: lyzhang1999/hello-world-flask:latest
      ports:
        - containerPort: 5000
```
kubectl apply åº”ç”¨
```shell
$ kubectl apply -f flask-pod.yaml
pod/hello-world-flask created
```

> æŸ¥çœ‹Pod
```shell
kubectl get pods
NAME                READY   STATUS    RESTARTS   AGE
hello-world-flask   1/1     Running   0          32s
root@test:~# 
```

> è®¿é—®pod
```shell
# ä½¿ç”¨ kubectl port-forward å‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘æ“ä½œï¼Œæ‰“é€šå®¹å™¨å’Œæœ¬åœ°ç½‘ç»œ
$ kubectl port-forward pod/hello-world-flask 8000:5000
Forwarding from 127.0.0.1:8000 -> 5000
Forwarding from [::1]:8000 -> 5000
```

> åˆ é™¤Pod
```shell
$ kubectl delete pod hello-world-flask
pod "hello-world-flask" deleted
```